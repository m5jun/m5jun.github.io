---
layout: post
title: UML实战
description: UML实战
categories: 建模
keywords: UML, 建模, github, 博客, m5jun
---


# 背景

UML：全称是Unified Modeling Language（统一建模语言），使用UML建模有很多好处：
* 最大的好处是方便开发人员沟通，因为UML是大家都认可且遵守的规范；
* 建模有助于及早发现设计中的错误，同时加深我们对系统的理解；
* 一个系统前期建模好，会为后期系统的更改节省大量的成本；

# UML介绍

UML图主要分为两类：结构图和行为图。

* 结构图：从不同的抽象和实现程度上描述了一个系统和系统构建的静态结构，并且描述了他们直接是如何关联到一起的。
* 行为图：展示了一个系统中的对象的动态行为，它描述了一个系统中的对象如何随着时间变化而变化。

我们在做系统设计时经常需要做领域建模，所谓的领域模型也叫概念模型，是对现实世界概念类的描述，并非软件对象描述，领域模型不是数据模型。
在UML中领域模型被描述为一组没有操作的类图，每个类有三个要素（类名、属性、关联）任何属性都不表示外键，应该直接使用关联关联到外键所在类。

下面的画图软件用的是plantUml，[具体语法介绍点我](http://plantuml.com/)

## 用例图

用例图是软件需求分析到软件交付的第一步，用例图的主要目的是说明这个软件的使用者是谁，使用者要使用那些功能，以及使用者需要向软件提供什么功能。

用例图可以让使用者清楚的理解这个软件到底能提供什么功能，是不是满足自己的需求，对开发者来说，可以更好地理解需求，从而能更好的去实现这些需求。

用例图包含六个元素：

* 参与者
* 用例
* 关联关系
* 包含关系
* 扩展关系
* 泛化关系

下面分别对以上元素进行介绍。

### 参与者

参与者在UML中用下面带有名字的小人来标示，主要表示与您的软件系统交互的人，组织或者外部软件系统。

![参与者](/images/posts/uml/actor.png)

### 用例

用例在UML中用使用椭圆标示，主要说明你的软件系统的功能，是使用文字描述的形式说明你的系统的功能。

![用例](/images/posts/uml/usecase.png)

### 关联关系

在用例图中用箭头来标示，主要描述参与者与用例之间的关系。箭头指用例。

![关联关系](/images/posts/uml/association.png)

### 包含关系

在UML中包含关系表示为带虚线的箭头加include，当一个用例很大时，我们可以把它分解为几个小用例来描述。箭头指向被包含的用例。

![包含](/images/posts/uml/include.png)

包含关系强调整体与部分之间关系，也就是说整体的功能是由一个个子用例功能叠加起来的。
例如第三方充值是必须要发生银行卡余额扣减，第三户账户余额增加的。

### 扩展关系

在UML中扩展关系表示为带虚线箭头加extend，扩展是指在基础用例功能的基础上插入新的功能点，新的功能点可以看做是对基础用例的扩展。箭头指向基础用例。

![扩展关系](/images/posts/uml/extends.png)

扩展关系则强调是在基础功能的基础上添加新的功能，基础功能本身是提供功能的，基础功能和扩展功能直接是不可见的，但是扩展功能是要在基础功能的某一个条件下才会发生，
例如某些APP登录的时候检测到可能存在的风险时需要人脸识别通过后再进行登录。

### 泛化关系

在UML中泛化用一个空心三角箭头从子用例指向父用例，泛化就是继承关系，子用例（子角色）可以使用父亲用例（父角色）中的属性，行为和关系。箭头指向父用例。

![泛化关系](/images/posts/uml/generalization.png)

泛化关系则强调复用的关系，也就是说子用例继承了父用例的一部分功能并且自己有新增了或者覆盖了父用例的功能，
例如用户在签约贷款时可以线上签约或线上签约，不同的签约方式本身可以定制化。

## 时序图

时序图是一种强调消息时序的交互图，主要由对象、消息、生命线和组合片段组成，它主要描述系统中对象和对象之间的交互，它将这些交互建模成消息交换。

时序图将交互关系展示成了一个平面二维图，其中纵向标示时间轴，时间沿竖线从上向下进行。
横向轴标示了交互中各个对象。对象的的用生命线表示。
消息从一个对象的生命线到另一个对象生命线的箭头表示，箭头以时间顺序在图中从上到下排列，从左到右排列。

### 对象&生命线

生命线头上那个方正的框里面存放的就是对象，对象有自己的名字，生命线其实就是从上到下的一个虚线。
生命线标示一个对象存在的生命周期，两条生命线中间通过消息连接起来。

![对象](/images/posts/uml/object.png)

### 消息

消息用于对象间传递信息，对象之间的交流就是通过消息，消息按照分类以下几类：
* 同步消息：发送消息的对象在发送消息后会挂住，等消息接受对象接受消息返回后才会解除挂住的状态继续自己的工作。
* 异步消息：发送消息的对象在发送消息后会继续自己的工作，而不等消息接受对象接受消息返回。
* 返回消息：标示发送消息后返回的动作。
* 自关联消息：一个对象内自调用的情况。

![消息](/images/posts/uml/message.png)

### 组合片段

#### loop

loop表示循环。

* 指定执行次数。

![循环指定次数](/images/posts/uml/loop.png)

* 当没有指定循环边界默认范围为[0,无穷大]。

![循环不指定次数](/images/posts/uml/loop1.png)

* 指定循环边界,则最少执行最小值值，最多执行最大值次数。

![循环区间](/images/posts/uml/loop2.png)

#### alt

alt用于条件判断。

![条件判断](/images/posts/uml/alt.png)

#### opt
switch，当满足不同条件执行不同方法。

#### break
退出循环。

#### par
同时进行，比如多个线程同时执行任务

#### group
group用来分组。

![group](/images/posts/uml/group.png)



## 类图

类图主要是用来展现软件系统中的类、接口以及它们之间的静态结构。

类之间关系分以下几类: 
* 泛化
* 实现
* 关联
* 聚合
* 组合
* 依赖

### 泛化
泛化是继承关系的一种，子类继承父类的所有行为和属性，子类可以新增新的功能或者重写父类功能。

用带空心的箭头由子类指向父类。

![继承](/images/posts/uml/class_generalization.png)

### 实现

实现是接口和类的关系，是指类实现了接口中定义的接口。

实现类用带空心三角箭头的虚线指向接口。

![继承](/images/posts/uml/class_realize.png)

### 关联

类之间的必然存在联系，关联使类可以感知其他类的行为和属性，关联分为双向和单向关联。

* 单向关联

对于一个单向关联来说，只有一个类知道这种联系的存在。

![单向关联](/images/posts/uml/class_oneway.png)

如图对于单向关联表示为一条带有指向已知类的开放箭头实线，单向关联只包含一个角色名和多重值。
一个用户可以有0个或者多个账户，用户可以感知账户的存在，但是账户却感知不到人的存在。

* 双向关联

对于双向关联来说被关联的两个类可以感知对方的存在。

|  标记 | 说明  |
| :------------: | :------------: |
| 0..1  | 0个或1个  |
| 0..*  | 0个或多个  |
| 1  | 只能1个  |
| *  | 0个或多个  |
| 1..*  | 1个或多个  |
| 3  | 只能3个  |
| 0..5  | 0到5个  |
| 5..15  | 5到15个  |

![双向关联](/images/posts/uml/class_route.png)

在看图时要注意，对于一条骑行路线来说，我们要看自行车端的多重值，一条骑行路线可能没有0辆自行车或多辆自行车。
0辆自行车是因为路线虽有制定好了，但共享单车可能还没有找到。
对于一辆自行车来说可以有0条路线或多条路线。0条路线是因为一辆自行车可以不参加骑行活动。

### 聚合

聚合是关联关系的一种，聚合主要描述整体与部分直接的关系，聚合有分为基本聚合和组合聚合。

对基本聚合来说部分类的生命周期独立于整体类的生命周期。

画图时由一条从整体类到部分类的实线，并在整体类的关联末端画一个未填充棱形标示。

![基本聚合](/images/posts/uml/class_aggretation.png)

一辆汽车有4个轮子，轮子的生命周期不依赖于车的，因为车轮可以独立于车存在。

### 组合

组合是上面聚合的另一种情况，部分类的生命周期依赖整体类。

UML中使用一条从整体类到部分类的实线，并在整体类的关联末端画一个填充棱形标示。


![组合](/images/posts/uml/class_composite.png)

一个公司存在一个或多个部门，部门不能独立存在，必须依赖公司存在。

### 依赖

依赖即一个类的实现需要其他类的协助，通常代码表现为方法参数，局部变量，静态方法调用，util类调用。

UML中使用一条带箭头的虚线，从依赖方指向被依赖的类。

![依赖](/images/posts/uml/class_dependency.png)


## 状态图

状态机图是一种行为图，它通过使用有限的状态转移展示了一个系统中一个模块的一些离散的行为。
主要包含两类状态机图：
* 行为状态机
* 协议状态机

### 基本元素

* 简单状态

简单状态没有子状态机和域。

UML中使用带拐点的矩形标示简单状态，并且状态名字写在矩形内部。

![简单状态](/images/posts/uml/easy_state.png)

* 组合状态

组合状态被定义为用子状态或者嵌套状态的状态行为，子状态可以是顺序发生的也可以是并发发生，组合状态里至少有一个域。

![组合状态](/images/posts/uml/state_composite.png)

起始状态：黑色实心表示。

终止状态：末端双环圆表示。

行为转移：中间连接线表示。


### 行为状态机

使用有限状态转移表示一个系统中的离散行为的变换，行为被建模为通过一系列转移线连接起来的状态。

![行为状态](/images/posts/uml/state_behavior.png)

### 协议状态机

协议状态机是行为状态机的一个子类，是行为状态的扩展，用来描述一个类的生命周期和协议，他描述一个类的哪一个动作可以被哪一个状态下的规定条件下被调用。

## 活动图

活动图是UML中一种行为图，它展示了控制流和对象流，并且强调它们的顺序和条件控制流。

详情语法请参考下面其他里的链接。


## 其他

* [更多UML介绍点我](https://www.uml-diagrams.org/)














